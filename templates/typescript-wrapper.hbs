/**
 * Generated MCP Wrapper: {{mcpName}}
 *
 * This file was auto-generated by code-executor-mcp.
 * DO NOT EDIT MANUALLY - changes will be overwritten on next generation.
 *
 * Generated: {{generatedAt}}
 * Schema Hash: {{schemaHash}}
 * Tool Count: {{toolCount}}
 *
 * @see https://github.com/aberemia24/code-executor-MCP
 */

{{#if moduleFormat}}
{{#if (eq moduleFormat "esm")}}
import type { ExecutionResult, ToolCallSummaryEntry } from 'code-executor-mcp';
{{else}}
const { ExecutionResult, ToolCallSummaryEntry } = require('code-executor-mcp');
{{/if}}
{{else}}
import type { ExecutionResult, ToolCallSummaryEntry } from 'code-executor-mcp';
{{/if}}

/**
 * MCP Server: {{mcpName}}
 * {{#if description}}
 * Description: {{description}}
 * {{/if}}
 *
 * Available Tools: {{toolCount}}
 */

{{#each tools}}
/**
 * {{this.description}}
 *
 * Tool: {{this.name}}
 *
 {{#if this.parameters.properties}}
 * Parameters:
 {{#each this.parameters.properties}}
 * @param {{@key}}{{#if this.description}} - {{this.description}}{{/if}}{{#if (lookup ../this.parameters.required @key)}} (required){{/if}}
 {{/each}}
 {{/if}}
 *
 * @returns Promise<ExecutionResult> - Execution result with output and metadata
 *
 * @example
 * ```typescript
 * const result = await {{../mcpName}}_{{camelCase this.name}}({
 {{#if this.parameters.properties}}
 {{#each this.parameters.properties}}
 *   {{@key}}: {{#if (eq this.type "string")}}'example'{{else if (eq this.type "number")}}123{{else if (eq this.type "boolean")}}true{{else if (eq this.type "array")}}[]{{else}}{}{{/if}},
 {{/each}}
 {{/if}}
 * });
 * console.log(result.output);
 * ```
 */
export async function {{../mcpName}}_{{camelCase this.name}}(
  params: {
    {{#each this.parameters.properties}}
    {{@key}}{{#unless (lookup ../this.parameters.required @key)}}?{{/unless}}: {{tsType this.type}};
    {{/each}}
  }
): Promise<ExecutionResult> {
  // Call MCP tool via code-executor
  const code = `
    const result = await callMCPTool('{{this.name}}', ` + JSON.stringify(params) + `);
    console.log(JSON.stringify(result));
  `;

  // Execute via code-executor-mcp executeTypescript
  const proxyUrl = process.env.CODE_EXECUTOR_PROXY_URL || 'http://localhost:3000';
  const authToken = process.env.CODE_EXECUTOR_AUTH_TOKEN;

  if (!authToken) {
    throw new Error('CODE_EXECUTOR_AUTH_TOKEN environment variable is required');
  }

  const response = await fetch(proxyUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${authToken}`
    },
    body: JSON.stringify({
      toolName: 'executeTypescript',
      params: {
        code,
        allowedTools: ['{{this.name}}'],
        timeoutMs: 30000
      }
    })
  });

  if (!response.ok) {
    throw new Error(`MCP call failed: ${response.statusText}`);
  }

  return await response.json();
}

{{/each}}

/**
 * Type definitions for {{mcpName}} MCP server
 */
export namespace {{pascalCase mcpName}} {
  {{#each tools}}
  export interface {{pascalCase this.name}}Params {
    {{#each this.parameters.properties}}
    {{@key}}{{#unless (lookup ../this.parameters.required @key)}}?{{/unless}}: {{tsType this.type}};
    {{/each}}
  }

  {{/each}}
}

{{#if moduleFormat}}
{{#if (eq moduleFormat "commonjs")}}
// CommonJS export
module.exports = {
  {{#each tools}}
  {{../mcpName}}_{{camelCase this.name}},
  {{/each}}
};
{{/if}}
{{/if}}
